CRUSH作为Ceph集群最为核心的数据分布算法，需要解决大规模分布式存储系统面临艰巨的任务。当前存储设备已经发展至数十、数百、甚至是数千的存储设备，而数据通常会达到PB这个数量级以至更高。当前的存储系统必须能够均匀的分配数据和工作负载，以高效的利用现有可用资源、系统性能， 同时要便于集群的扩展以及对硬件故障的处理。
CRUSH算法正是实现了一个伪随机的数据分发功能，它被设计用于基于对象的分布式存储系统，这样的系统不依赖于某个中央目录就能够实现数据对象到存储设备的映射。另外大型存储系统的发展本质就是动态的，所以CRUSH被设计成便于增加和移除存储设备，同时能将非必要的数据移动降至最低。该算法还包括了各种各样的数据复制和可靠性机制，并按照用户定义的策略来分发数据，而且这样的策略还能强制执行跨越故障域的备份分离。

CRUSH Map
集群映射由设备和桶（buckets）组成层级树，设备和桶都有数值的描述和权重值。例如：

桶可以包含任意多的设备或者其他的桶，并由此形成内部节点的存储层次结构；而设备总是在叶节点。存储设备的权重由管理员设置以控制相设备负责存储的相对数据量。尽管大型存储系统的往往会包含不同的容量大小、性能快慢的设备，CRUSH算法可以根据设备的利用率和负载来分布数据。
设备的平均负载与存储的数据量成正比，这决定了设备的权重应来取自于设备的各项能力，而桶的权重则是它所包含的元素的权重的总和。
桶可由任意可用存储的层次结构组成。例如，可以创建这样一个集群映射，用名为“shelf”的桶代表最低层的一个主机，用来包含主机上的磁盘设备，然后用名为“cabinet”的桶来包含在同一个机架上的主机。在一个大的系统中，代表机架的“cabinet”桶可能还会包含在“row”桶或者“room”桶里。数据通过一个伪随机类hash函数递归地分配到各个层级的桶元素中。相比传统的散列分布技术，一旦集群中的存储设备数量有变，就会导致大量的数据迁移；而CRUSH算法是基于桶四个不同的类型，每一个都有不同的选择算法，以解决添加或删除设备造成的数据移动和整体的计算复杂度。


CRUSH算法根据种每个设备的权重尽可能概率平均地分配数据。分布算法是由集群可用存储资源以及其逻辑单元的map控制的。这个map的描述类似于一个大型存储场景的描述：存储服务器由一系列的机柜组成，机柜装满服务器，服务器装满磁盘。数据分配的策略是由定位规则来定义的，定位规则指定了集群中将保存多少个副本，以及数据副本的放置有什么限制。例如，可以指定数据有三个副本，这三个副本必须放置在不同列的机柜中，进而使得数据的三个副本不公用一条物理电路。
给定一个输入x，CRUSH 算法将输出一个确定的有序的储存目标向量   ⃗R 。当输入x，CRUSH利用强大的多重整数hash函数根据集群map、定位规则、以及x计算出确定的、独立的、可靠的映射关系。CRUSH分配算法是伪随机算法，并且输入的内容和输出的储存位置之间是没有显性相关的，所以我们可以说CRUSH 算法在集群设备中生成了“伪集群”的数据副本。集群的设备对一个数据项目共享数据副本，对其他数据项目又是独立的。



